THIS=Makefile-C
VERSION=20060623

OBJS := fe2.s.o fe2.s.fn.o host.o

MY_CFLAGS := -O0 -fomit-frame-pointer -Wall -Wno-unused -s `sdl-config --cflags`

export CFLAGS = $(MY_CFLAGS) -DOGG_MUSIC
export LIBS = -lGL -lGLU -lvorbisfile -lvorbis -logg
export FE2OBJS = $(addprefix ../,$(OBJS))

default:
	$(MAKE) -C as68k/
	$(MAKE) -f $(THIS) $(OBJS)
	$(MAKE) -C src/

fe2clean:
	rm -f fe2.s.bin $(OBJS) fe2.s.c fe2.s.fn.c fixups.h frontier

fe2:
	$(MAKE) -f $(THIS) fe2clean
	$(MAKE) -f $(THIS) $(OBJS)
	$(MAKE) -C src/

fe2.s.c: fe2.s
	as68k/as68k --output-c fe2.s

fe2.s.fn.c: fe2.s.c

%.o: %.c
	$(CC) $(MY_CFLAGS) -c $< -o $@

clean:
	$(MAKE) -C src/ clean
	rm -f frontier
	$(MAKE) -f $(THIS) fe2clean

allclean:
	$(MAKE) -f $(THIS) clean
	$(MAKE) -C as68k/ clean
	$(MAKE) -C dis68k/ clean
	$(MAKE) -f $(THIS) fe2clean

# To make a nice clean tarball
dist:
	$(MAKE) -f Makefile-i386 clean
	$(MAKE) -f $(THIS) allclean
	mkdir frontvm3-$(VERSION)
	mkdir frontvm3-$(VERSION)/as68k
	mkdir frontvm3-$(VERSION)/dis68k
	mkdir frontvm3-$(VERSION)/src
	mkdir frontvm3-$(VERSION)/savs
	#mkdir frontvm3-$(VERSION)/sfx
	#mkdir frontvm3-$(VERSION)/music
	cp as68k/* frontvm3-$(VERSION)/as68k
	cp dis68k/* frontvm3-$(VERSION)/dis68k
	cp src/* frontvm3-$(VERSION)/src
	#cp sfx/* frontvm3-$(VERSION)/sfx
	#cp music/* frontvm3-$(VERSION)/music
	cp fe2.s frontvm3-$(VERSION)
	cp m68000.h frontvm3-$(VERSION)
	cp _host.c frontvm3-$(VERSION)
	cp notes.txt frontvm3-$(VERSION)
	cp benchmarks.txt frontvm3-$(VERSION)
	cp README frontvm3-$(VERSION)
	cp TODO frontvm3-$(VERSION)
	cp Makefile-i386 frontvm3-$(VERSION)
	cp Makefile-C frontvm3-$(VERSION)
	cp Makefile-mingw frontvm3-$(VERSION)
	tar cvjf frontvm3-$(VERSION).tar.bz2 frontvm3-$(VERSION)
	rm -rf frontvm3-$(VERSION)

# save bandwidth...
audio-dist:
	mkdir frontvm-audio-$(VERSION)
	mkdir frontvm-audio-$(VERSION)/sfx
	mkdir frontvm-audio-$(VERSION)/music
	cp sfx/* frontvm-audio-$(VERSION)/sfx
	cp music/* frontvm-audio-$(VERSION)/music
	tar cvjf frontvm-audio-$(VERSION).tar.bz2 frontvm-audio-$(VERSION)
	rm -rf frontvm-audio-$(VERSION)

